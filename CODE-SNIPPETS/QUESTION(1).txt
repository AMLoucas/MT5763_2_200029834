CODE USED TO ANSWER QUESTION 1 (Is there an effect of Luxuriant above and beyond the placebo?)
..............................................................................................
/* MT5763 */
/* Generated code for Indiviual Project 2 */

/* DROPPING ANY OLD TABLES */
%web_drop_table(WORK.BALDY);
%web_drop_table(WORK.LUXURIANT);
%web_open_table(WORK.PLACEBO);
%web_open_table(WORK.BALDBEGONE);
%web_open_table(WORK.SKINHEADNOMORE);

/* IMPORTING THE CSV FILE WITH NAME: BALDY */
FILENAME REFFILE '/folders/myfolders/sasuser.v94/Practical-Individual/Baldy.csv';

PROC IMPORT DATAFILE=REFFILE
	DBMS=CSV
	OUT=WORK.BALDY;
	GETNAMES=YES;
	GUESSINGROWS=MAX;
RUN;

PROC CONTENTS DATA=WORK.BALDY; 
RUN;
%web_open_table(WORK.BALDY);

/* FUNCTION THAT GETS 5 ARGUMENTS (data,column hair growht, column age, inches to mm formula, treatment used) */
/* Breaks the data table to smaller individual table concerning only 1 treatment. */
/* Sorts each individual table by age */
/* Data will be wrangled/tidy in here in correct format to apply statystical analysis on them */

%MACRO breakTables(dataName, columnHair, columnAge, toMMmeasure, group);

/* Creating individual table for each treatment */

DATA WORK.&columnHair;
SET WORK.&dataName;
KEEP &columnHair &columnAge;
/* Changin hair growth from inches to MM */
&columnHair = &columnHair * &toMMmeasure;
RUN;

/* Renaming the age column to simple Age, Measure of hair growth to HairGrowth */
/* Adding new column group that indicates for which treatments the data is (for mergeing tables later) */
DATA WORK.&columnHair;
SET WORK.&columnHair;
RENAME &columnAge = Age;
RENAME &columnHair = HairGrowth;
GROUP = &group;
RUN;

/* Sorting the data according to the age of patient */
PROC SORT DATA = WORK.&columnHair;
BY HairGrowth;
RUN;

%web_open_table(WORK.&columnHair);

%MEND;

%breakTables(BALDY, LUXURIANT, AgeLuxuriant, 25.4, "LUXURIANT")
%breakTables(BALDY, PLACEBO, AgePlacebo, 25.4, "PLACEBO")
%breakTables(BALDY, BALDBEGONE, AgeBaldBeGone, 25.4, "BALDBEGONE")
%breakTables(BALDY, SKINHEADNOMORE, AgeSkinheadnomore, 25.4, "SKINHEADNOMORE")

/* Merge tables all to one */
DATA WORK.cleanData;
MERGE WORK.LUXURIANT WORK.PLACEBO WORK.BALDBEGONE WORK.SKINHEADNOMORE;
BY HairGrowth;
RUN;

/* For Question -1 */
/* KEEPING ONLY DATA FOR PLACEBO AND LUXURIANT */
DATA WORK.QUESTION1;
SET WORK.cleanData;
KEEP HairGrowth GROUP;
/* KEEP ROWS THAT ARE TREATMENTS FROM LUXURIANT OF PLACEBO */
	WHERE GROUP="LUXURIANT" OR GROUP="PLACEBO";
RUN;

/* FIT A LINEAR MODEL USING THE GROUP AS FACTOR, TO SEE HOW GOOD A TREATMENT IS */
/* OUR P-VALUE WILL CHECK IF OUR TWO MEANS ARE EQUALL. IF NOT EQUAL, THA ONE WITH 
HIGHEST MEAN IS THE BST */


PROC GLM DATA = WORK.QUESTION1 outstat=ERRORS plots = all;
	  CLASS GROUP;
	  MODEL HairGrowth = GROUP;
RUN;
QUIT;
..............................................................................................
ASSUMPTIONS FOR LINEAR MODELLING ARE VIOLATED SO P-VALUE IS NOT TRUSTWORTHY.
WE NEED TO APPLY A RANDOMISED TEST TO CHECK OUR RESULTS
..............................................................................................
..............................................................................................
/* QUESTION 1 */

/* DROPPING TABLES TO RE-CREATE THEM */
%web_drop_table(WORK.BALDYq1);

/* IMPORTING THE CSV FILE TO APPLY COMPUTATIONS */
FILENAME REFFILE '/folders/myfolders/sasuser.v94/Practical-Individual/Baldy.csv';

PROC IMPORT DATAFILE=REFFILE
	DBMS=CSV
	OUT=WORK.BALDYq1;
	GETNAMES=YES;
RUN;

PROC CONTENTS DATA=WORK.BALDYq1; RUN;

%web_open_table(WORK.BALDYq1);

/* DATA WRANGLE TO APPLY RANDOMISED TEST 
 KEEPING ONLY HAIRGROWTH VALUES FOR LUXURIANT AND PLACEBO 
 FINDING THE MEAN FOR THE TWO DIFFERENT GROUPS HAIRGROWTH 
 FINDING THE DIFFERENCE VALUE 
 COMPARING THE ORIGINAL DATA MEAN DIFFERENCE WITH RANDOMISED 
 TO CHECK IF OUR MEANS ARE EQUAL.
 RANDOMISED DATA IS CREATE ASSUMING THE MEANS ARE EQUAL. */

/*------------------------------------------------------*/
/*-------------ORIGINAL MEAN DIFFERENCE---------------- */
/*------------------------------------------------------*/

/* KEEPING ONLY TWO COLUMNS WE INTERESTED */
DATA WORK.BALDYq1;
	SET WORK.BALDYq1;
	KEEP LUXURIANT PLACEBO;
RUN;

/* CREATING THE LUXURIANT TABLE 
	CONVERTING THE INCHES TO MM FOR HAIRGROWTH
	PUTTING COLUMN GROUP TO SHOW WHICH GROUP VALUE REPRESENTS */
DATA LUXURIANT;
	SET WORK.BALDYq1;
	GROUP = "LUXURIANT";
	LUXURIANT = LUXURIANT * 25.4;
	KEEP LUXURIANT GROUP;
	RENAME LUXURIANT = HairGrowth;
RUN;

/* CREATING THE PLACEBO TABLE 
	CONVERTING THE INCHES TO MM FOR HAIRGROWTH
	PUTTING COLUMN GROUP TO SHOW WHICH GROUP VALUE REPRESENTS */
DATA PLACEBO;
	SET WORK.BALDYq1;
	GROUP = "PLACEBO";
	PLACEBO = PLACEBO * 25.4;
	KEEP PLACEBO GROUP;
	RENAME PLACEBO = HairGrowth;
RUN;

/* SORTING BOTH TABLES BY HAIRGROWTH TO MERGE THEM */
PROC SORT DATA = WORK.LUXURIANT;
	BY HairGrowth;
RUN;
PROC SORT DATA = WORK.PLACEBO;
	BY HairGrowth;
RUN;

/* MERGE BOTH TABLES TOGETHER NOW */
DATA WORK.BALDYQ1;
	MERGE WORK.LUXURIANT WORK.PLACEBO;
	BY HairGrowth;
RUN;

/* NEED TO SORT NEW TABLE BY GROUP SO MEANS CAN BE OBTAINED 
	FINDING MEAN VALUES FOR HAIRGROWTH FOR EACH GROUP */
PROC SORT DATA = WORK.BALDYQ1;
	BY GROUP;
RUN;

/* FINDING MEAN OF GROWTH HAIR FOR EACH GROUP 
	RESULT TABLE OF MEANS IS HELD IN VARIABLE "OriginalMeans" */
PROC MEANS data =WORK.BALDYQ1;
	VAR HairGrowth; 
	BY GROUP;
	OUTPUT OUT=OriginalMeans mean=; 
RUN;

/* KEEPING ONLY DATA INTERESTED FROM MEAN TABLE "OriginalMeans" */
DATA WORK.OriginalMeans;
	SET WORK.OriginalMeans;
	KEEP GROUP HairGrowth;
RUN;

/* TransposING TABLE TO GET THE DIFFERENCE OF THE TWO MEANS
	APPLYING A ONE TAIL TEST. ALTERNATIVE HYPOTHESIS:
	LUXURIANT > PLACEBO */
PROC TRANSPOSE 
	DATA= WORK.OriginalMeans 
	out = WORK.OriginalMeans;
RUN;

/* GET ORIGINAL DIFFERENCE LUXURIANT - PLACEBO (H1)*/
DATA WORK.OriginalMeans;
	SET WORK.OriginalMeans;
	DIFFERENCE=COL1-COL2;  /*GETTING DIFFERENCE */
	KEEP DIFFERENCE;
RUN;

/* REPLICATING THE VALUE TO CREATE TABLE SAME LENGTH AS RANDOMIZED DATA
	LENGHT OF RANDOMIZED 500 */
PROC SURVEYSELECT 
	data=WORK.OriginalMeans 
	out=WORK.OriginalMeans 
	seed=2345
	METHOD=urs 
	noprint 
	sampsize=1 
	outhits rep=500; 
RUN;

/* FILTERING COLUMNS TO ONE ONLY INTERESTED 
	"DIFFERENCE" HOLDS THE MEAN DIFFERENCE OF ORIGINAL DATA */
DATA WORK.OriginalMeans ;
	SET WORK.OriginalMeans ;
	KEEP DIFFERENCE;
RUN;


/*------------------------------------------------------*/
/*------------RANDOMIZING MEAN DIFFERENCE-------------- */
/*------------------------------------------------------*/

/* FUNCTION THAT DEALS WITH RANDOMIZATION 
	GETS 6 ARGUMETNS :
	(1)NLoops ->  Number of simulations to compute
	(2)Table -> Data set we will work on.
	(3)GroupVariable -> Variable holding group values.
	(4)GroupOneLabel -> Group of interest(1) "LUXURIANT"
	(5)GroupTwoLabel -> Group of interest(2) "PLACEBO"
	(6)ResponseVariable -> Value we are interested to get mean "HairGrowth"
	*/
%MACRO TwoSampRandTest(NLoops, Table, GroupVariable, GroupOneLabel, GroupTwoLabel, ResponseVariable);

/* STARTS LOOP OF RANDOMIZING NUMBEROFLOOPS TIMES */	
%DO i=1 %TO &NLoops;

	/* CREATING A DATASET HOLDING A RANDOM UNIFROM VALUE
		FOR EACH GROUP. OUR DATA IS CREATED ASSUMING THE MEANS OF
		BOT GROUPS ARE EQUAL. SO BOTH OUR GROUPS WILL HAVE SIMILAR VALUES.*/
	DATA RandomGroup;
		SET &Table
		(KEEP=&GroupVariable); /* ONLY GROUP COLUMN KEEP */
		RandomIndex=rand('uniform'); /* RANDOM UNIFORM NUMBER COLUMN CREATED */
	RUN;
	
	/* SORTS THE DATA SET BY THE RANDOM UNIFORM NUMBERS GENERATED 
		TO SORT THE TABLE IN A RANDOM ORDER AND SHUFFLE THE HAIRGROWTH VALUES
		TO DIFFERENT GROUPS. CHANGING THE VALUES OF HAIRGRWOTH FOR EACH GROUP
		BETWEEN THEM RANDOMLY TO DISTRIBUTE A RANDOM EQUAL GROUPS.*/
	PROC SORT 
		data=RandomGroup 
		out=RandomGroup;
		by RandomIndex;
	RUN;

	/* MERGING RANDOM GROUPS WITH REAL GROUPS */
	DATA WorkingData;
		merge RandomGroup(keep=&GroupVariable) &Table(drop=&GroupVariable);
	RUN;

	/* BREAKING THE MERGED TABLE TO 2 INDIVIDUAL ONES.
		EACH TABLE CORRESPONFING TO ITS APPROPRIATE GROUP*/
		
	DATA WORK.RandomGroup1;
		SET WORK.WorkingData;
		WHERE &GroupVariable=&GroupOneLabel;
	DATA WORK.RandomGroup2;
		SET WorkingData;
		WHERE &GroupVariable=&GroupTwoLabel;
	RUN;
	
	/* GETTING THE MEAN OF HAIRGWOTH FROM GROUP 1. */
	PROC MEANS 
		data=RandomGroup1 noprint;
		var &ResponseVariable;
		output out=GroupOneMean mean=mean;
	RUN;

	/* GETTING THE MEAN OF HAIRGWOTH FROM GROUP 2. */
	PROC MEANS 
		data=RandomGroup2 noprint;
		var &ResponseVariable;
		output out=GroupTwoMean mean=mean;
	RUN;
	
	/* _NULL_ INDICATES THAT DATASET WILL BE DELETED ONCE USED.
	 	symput('GroupOneMean', mean) -> CREATES A MACRO VARIABLE CALLED
	 	"GroupOneMean" THA WILL HOLD THE MEAN FROM GROUP 1 */
	DATA _NULL_;
		SET GroupOneMean;
		CALL symput('GroupOneMean', mean);
	RUN;
	
	/* DOING THE SAME AS ABOVE BUT OBTAINING GROUP 2 MEAN. */
	DATA _NULL_;
		SET GroupTwoMean;
		CALL symput('GroupTwoMean', mean);
	RUN;

	/* OBTAINING THE DIFFERENCE OF THE TWO MEANS. */
	DATA LoopDifference;
		RandomisedMean=&GroupOneMean-&GroupTwoMean;
	RUN;

	/* TABLE THAT WILL HOLD THE SAMPLE MEAN DIFFERENCE OF ALL THE SIMULATION SAMPLE DATA */
	DATA FinalResultRandomised;
		/* IF FIRST RUN OF LOOP PUT THE "LoopDifference" AS FIRST ROW. */
		%IF &i=1 %THEN %DO;
			set LoopDifference;
		%END;
		/* IF NOT FIRST RUN APPEND "LoopDifference" ON THE ALREADY EXISTING TABLE */
		%ELSE %DO;
			SET FinalResultRandomised LoopDifference;
		%END;
	RUN;
	%END;
%MEND;

%TwoSampRandTest(NLoops=500, Table=WORK.BALDYQ1, GroupVariable=GROUP, GroupOneLabel="LUXURIANT", GroupTwoLabel="PLACEBO", ResponseVariable=HairGrowth);

/* JOIN THE RANDOMISED MEANS WITH THE ORIGINAL DIFFERENT MEANS
	SIDE BY SIDE SO WE CAN FIND THE PROPORTION WE ARE INTERESTED IN.*/
DATA FinalResultRandomised;
MERGE FinalResultRandomised WORK.OriginalMeans;
RUN;

/* FILTER THE ROWS TO KEEP THE ONES THE RANDOMISED MEANS IS LARGER 
	THAN THE ACTUAL DIFFERENT MEAN. IF ITS ABOUT HALF OD THE ACTUAL LENGTH
	250 THEN THIS INDICATES OUR MEANS ARE EQUAL.*/
DATA HypothesisResult;
SET FinalResultRandomised;
WHERE RandomisedMean >= DIFFERENCE; 
RUN;

..............................................................................................